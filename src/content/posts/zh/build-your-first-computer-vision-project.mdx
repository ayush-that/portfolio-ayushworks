---
title: "构建你的第一个计算机视觉项目"
description: 使用Python、OpenCV和手部检测创建单人乒乓球游戏。包含分步指南，非常适合计算机视觉初学者
tags: ["computer-vision", "python", "opencv"]
date: 2024-07-13
published: true
cover: "./images/cover/build-your-first-computer-vision-project.avif"
---

你是否曾想打乒乓球却找不到对手？好吧，只需一点编程和[计算机视觉](https://en.wikipedia.org/wiki/Computer_vision)，你就可以创建一个让你与自己对战的单人[乒乓球](https://en.wikipedia.org/wiki/Table_tennis)游戏！

在这篇博客文章中，我将逐步指导你如何使用Python、[OpenCV](https://opencv.org/)和手部检测模块来制作这个游戏。

## SoloPong演示

要查看单人乒乓球游戏的实际效果，请观看下面的演示视频。看我如何使用摄像头检测到的手势来玩游戏。

<iframe
  width="560"
  height="315"
  src="https://www.youtube.com/embed/4_GEyFlE7M0?si=lV-2RyX04tJkmqgK"
  title="YouTube video player"
  frameborder="0"
  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
  referrerpolicy="strict-origin-when-cross-origin"
  allowfullscreen
></iframe>
GitHub - [https://github.com/ayush-that/SoloPong](https://github.com/ayush-that/SoloPong)

## 你需要准备什么

- 电脑上安装的[Python](https://www.python.org/downloads/)
- 一个摄像头
- 一些游戏图片资源（球、球拍、背景和游戏结束画面），可从[GitHub](https://github.com/ayush-that/SoloPong)仓库获取

  ![](https://cdn.hashnode.com/res/hashnode/image/upload/v1720892343515/26fd1a83-f262-4f47-baad-793403574a9b.png)

## 编写代码

1. **导入库并设置摄像头**

```python
import numpy as np
import cv2 as cv
import cvzone
from cvzone.HandTrackingModule import HandDetector

cap = cv.VideoCapture(0)
cap.set(3, 1280)
cap.set(4, 720)
```

我们首先导入必要的库。我们使用OpenCV（`cv`）进行图像处理，`cvzone`进行手部检测，[NumPy](https://numpy.org/doc/stable/)（`np`）进行数值运算。然后我们设置分辨率为1280x720的摄像头。

2. **加载图片资源**

```python
imgBg = cv.imread("assets/bg.png")
imgGO = cv.imread("assets/gameover.png")
imgBall = cv.imread("assets/ball.png", cv.IMREAD_UNCHANGED)
imgBat1 = cv.imread("assets/bat1.png", cv.IMREAD_UNCHANGED)
imgBat2 = cv.imread("assets/bat2.png", cv.IMREAD_UNCHANGED)
```

我们加载背景、游戏结束画面、球和球拍的图片。确保你的assets文件夹中有这些图片。

3. **设置手部检测器**

```python
detector = HandDetector(detectionCon=0.8, maxHands=2)
```

我们初始化手部检测器，设置检测置信度为0.8，最多检测2只手。

4. **初始化游戏变量**

```python
ballPos = [100, 100]
speedX = 25
speedY = 25
gameOver = False
score = [0, 0]
```

我们设置球的初始位置和速度。我们还初始化游戏结束标志和分数。

5. **主游戏循环**

```python
while True:
    _, img = cap.read()
    img = cv.flip(img, 1)
    imgRaw = img.copy()
```

我们进入主游戏循环，从摄像头读取帧，并水平翻转以产生镜像效果。我们还复制一份原始帧。

6. **手部检测和叠加球拍**

```python
hands, img = detector.findHands(img, flipType=False)
img = cv.addWeighted(img, 0.1, imgBg, 0.9, 0)

if hands:
    for hand in hands:
        x, y, w, h = hand["bbox"]
        h1, w1, _ = imgBat1.shape
        y1 = y - h1 // 2
        y1 = np.clip(y1, 20, 415)

        if hand["type"] == "Left":
            img = cvzone.overlayPNG(img, imgBat1, (59, y1))
            if 59 < ballPos[0] < 59 + w1 and y1 < ballPos[1] < y1 + h1:
                speedX = -speedX
                ballPos[0] += 30
                score[0] += 1

        if hand["type"] == "Right":
            img = cvzone.overlayPNG(img, imgBat2, (1195, y1))
            if 1195 - 50 < ballPos[0] < 1195 and y1 < ballPos[1] < y1 + h1:
                speedX = -speedX
                ballPos[0] -= 30
                score[1] += 1
```

我们在帧中检测手部，并根据手的位置叠加球拍。如果球击中球拍，它的方向会改变，分数会更新。

7. **球的移动和碰撞检测**

```python
if ballPos[0] < 40 or ballPos[0] > 1200:
    gameOver = True
if gameOver:
    img = imgGO
    cv.putText(
        img,
        str(score[1] + score[0]).zfill(2),
        (585, 360),
        cv.FONT_HERSHEY_COMPLEX,
        2.5,
        (200, 0, 200),
        5,
    )

else:
    if ballPos[1] >= 500 or ballPos[1] <= 10:
        speedY = -speedY

    ballPos[0] += speedX
    ballPos[1] += speedY

    img = cvzone.overlayPNG(img, imgBall, ballPos)
    cv.putText(
        img,
        str(score[0]),
        (300, 650),
        cv.FONT_HERSHEY_COMPLEX,
        3,
        (255, 255, 255),
        5,
    )
    cv.putText(
        img,
        str(score[1]),
        (900, 650),
        cv.FONT_HERSHEY_COMPLEX,
        3,
        (255, 255, 255),
        5,
    )
```

我们更新球的位置并检查与屏幕边缘的碰撞。如果球出界，游戏结束。否则，我们继续更新球的位置并将其叠加到帧上。

8. **显示游戏**

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1720892600594/523b8490-cba7-45c6-b6cd-3b516b3ff6dc.png)

```python
img[580:700, 20:233] = cv.resize(imgRaw, (213, 120))
cv.imshow("Image", img)
key = cv.waitKey(1)
if key == ord("r"):
    ballPos = [100, 100]
    speedX = 25
    speedY = 25
    gameOver = False
    score = [0, 0]
    imgGO = cv.imread("assets/gameover.png")
```

我们显示游戏帧并处理按"R"键重置游戏。

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1720892568086/67aa413b-01c6-4c90-b153-2239c04e13ef.png)

感谢你的关注！祝你构建和游玩自己的单人乒乓球游戏愉快。如果你有任何问题或遇到问题，请随时在下方留言。
